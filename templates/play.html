<!DOCTYPE html>
    <html lang="en">
    <meta charset="utf-8">

        <head>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

            <meta name="viewport" content="initial-scale=1, width=device-width">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>


            <!-- http://getbootstrap.com/docs/4.5/ -->
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

            <!-- https://favicon.io/emoji-favicons/money-mouth-face/ -->
            <link href="/static/img/my.ico" rel="icon">

            <link href="/static/css/styles.css" rel="stylesheet">
            <link href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css'>
            <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js'></script>
            <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css'>
            <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
            <!-- http://getbootstrap.com/docs/4.5/ -->
            <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
            <script src="/static/js/jquery-1.10.2.min.js"></script>
            <title>M-PyER</title>
            <style>
            #img-text {
            text-align: justify;
            width: 250px;
            color: white;
            }

            #img-text img {
            display: block;
            margin: 0 auto;
            }
            #column{
              float: left;
              padding-left: 5px;
              margin-left: 10px;
            }

            /* Clearfix (clear floats) */
            #row::after {
              content: "";
              clear: both;
              display: table;
            }

            progress {
              border-radius: 3px;
              width: 100%;
              height: 5px;
              box-shadow: 1px 1px 4px rgba( 0, 0, 0, 0.2 );
            }
            progress::-webkit-progress-bar {
              background-color: gray;
              border-radius: 3px;
            }
            progress::-webkit-progress-value {
              background-color: #880018;
              border-radius: 3px;
              box-shadow: 1px 1px 5px 3px rgba( 255, 0, 0, 0.8 );
            }
            progress::-moz-progress-bar {
              /* style rules */
            }


            </style>
        </head>
        <body>


          <div id="mySidenav" class="sidenav">
            <div id="sidebar">
              <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
              <img id="A1" src="{{ data['thumbnail'] }}"/>
              <figcaption id="A2" style="text-align:center;color:#fff;">{{ data['title'] }}</figcaption>
              <br>
              <h4 style="font-family:verdana;color:#358002;text-align:center;text-decoration:underline;">Favourites</h4>
              <br>

            </div>
      </div>


<div id="main">
  <section id="nav-bar">
      <nav class="navbar navbar-expand-lg navbar-light ">
          <div class="container-fluid">
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
                  <i class="fa fa-bars" ></i>
              </button>
              <a class="navbar-brand" href="\"><img src="/static/img/my.ico" style="height:80px;"></a>

                  <form class="d-flex">
                  <input class="form-control me-2" autocomplete="off" id="in"name="in" type="search" placeholder="Search" aria-label="Search">
                  <button class="btn btn-outline-success" type="submit">Search</button>
                </form>

          </div>
      </nav>
  </section>
  <span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776;</span>
  <div id="bg">
            <div id="blackLayer"></div>
            <img id="A3" src="{{ data['thumbnail'] }}"/>
        </div>

        <div id="main1">
            <div id="image">
                <img id="A4" src="{{ data['thumbnail'] }}"/>
            </div>
            <div id="player">
                <div id="songTitle">{{ (data['title']) }}</div>
                <br>
                <br>
                <div id="buttons">
                    <button id="download"><img src="\static\img\download.png" height="140%" width="140%"/></button>
                    <button id="pre" onclick="pre()" ><img src="\static\img\Pre.png" height="90%" width="90%"/></button>
                    <button id="play" ><img id="play1" src="\static\img\Pause.png"/></button>
                    <button id="next" onclick="next()"><img src="\static\img\Next.png" height="90%" width="90%"/></button>
                    <button id="heart" onclick="like()"><img id="liked" src="\static\img\heart1.png" height="140%" width="140%"/></button>
                </div>

                <progress id="progressBar" max="100" value="0.1" style="width:100%">Progress</progress>

            </div>
        </div>
        <section class="danner">
          <div id="row">
          </div>

        </section>

</div>
<div id="player2"></div>
<script type="text/javascript">
var dict=[];
var flag = 0;
var liked=[];

function openNav() {
  document.getElementById("mySidenav").style.width = "250px";
  document.getElementById("main").style.marginLeft = "250px";
  document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
}

function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
  document.getElementById("main").style.marginLeft= "0";
  document.body.style.backgroundColor = "white";
}
var tag = document.createElement('script');

tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// 3. This function creates an <iframe> (and YouTube player)
//    after the API code downloads.
var player;
let i=1,k=0;
function onYouTubeIframeAPIReady() {
  player = new YT.Player('player2', {
    height: '1',
    width: '1',
    videoId: '{{ data['vid_id'] }}',
    events: {
      'onReady': onPlayerReady,
    }
  });
}

// 4. The API will call this function when the video player is ready.
function onPlayerReady(event) {
player.stopVideo();
player.playVideo();

}

  function like(){
    document.getElementById("liked").src = "/static/img/heart2.png";
    liked.push({
      thumbnail:document.getElementById("A4").src,
      title:document.getElementById("songTitle").innerHTML,
      vid_id:document.getElementById("player2").src,
    });
    var like = JSON.parse(JSON.stringify(liked[liked.length-1]))
    var main = document.getElementById('sidebar');
    var but =  document.createElement('button');
    var func = "switch1("+(liked.length-1)+")";
    but.setAttribute('onclick',func);

    var newimg = document.createElement('img');
    newimg.src = like.thumbnail;
    newimg.style.width='100%';


    var x = document.createElement('FIGCAPTION');
    var t = document.createTextNode(like.title);
    x.style.color = "#fff";

    x.appendChild(t);

    but.appendChild(newimg);
    main.appendChild(but);
    main.appendChild(x);


  }
  function switch1(x){
    var like = JSON.parse(JSON.stringify(liked[x]));
    document.getElementById("A1").src=like.thumbnail;
    document.getElementById("A2").innerHTML= like.title;
    document.getElementById("A3").src=like.thumbnail;
    document.getElementById("A4").src=like.thumbnail;
    document.getElementById("songTitle").innerHTML=like.title;
    document.getElementById("player2").src = like.vid_id;
    document.getElementById("play1").src = "/static/img/Pause.png";
    document.getElementById("liked").src = "/static/img/heart2.png";
    i = 1;


  }
  function next(){
    var val = document.getElementById("songTitle").innerHTML;
    var i=0;
    for(i=0; i<liked.length-1;i++)
    {
      var like = JSON.parse(JSON.stringify(liked[i]));
      if(val == like.title)
      {
        like = JSON.parse(JSON.stringify(liked[i+1]));
        document.getElementById("A1").src=like.thumbnail;
        document.getElementById("A2").innerHTML= like.title;
        document.getElementById("A3").src=like.thumbnail;
        document.getElementById("A4").src=like.thumbnail;
        document.getElementById("songTitle").innerHTML=like.title;
        document.getElementById("player2").src = like.vid_id;
        document.getElementById("play1").src = "/static/img/Pause.png";
        document.getElementById("liked").src = "/static/img/heart2.png";
        i = 1;


      }
    }
  }
  function pre(){

      var val = document.getElementById("songTitle").innerHTML;
      var i=0;
      for(i=liked.length-1; i>0;i--)
      {
        var like = JSON.parse(JSON.stringify(liked[i]));

        if(val == like.title)
        {
          like = JSON.parse(JSON.stringify(liked[i-1]));
          document.getElementById("A1").src=like.thumbnail;
          document.getElementById("A2").innerHTML= like.title;
          document.getElementById("A3").src=like.thumbnail;
          document.getElementById("A4").src=like.thumbnail;
          document.getElementById("songTitle").innerHTML=like.title;
          document.getElementById("player2").src = like.vid_id;
          document.getElementById("play1").src = "/static/img/Pause.png";
          document.getElementById("liked").src = "/static/img/heart2.png";
          i = 1;


        }
      }


  }
  var playButton = document.getElementById("play");
  playButton.addEventListener("click", function() {
    if(i == 1)
    {
    document.getElementById("play1").src = "/static/img/Play.png";
    player.pauseVideo();
    i = 0;
    }
    else if(i == 0)
    {
      document.getElementById("play1").src = "/static/img/Pause.png";
      player.playVideo();
      i = 1;
    }

});

const progress = document.getElementById( "progressBar" );

function progressLoop() {
  setInterval(function () {
    progress.value = Math.round(
      (player.getCurrentTime() / player.getDuration()) * 100);
      //progress.value*(player.getDuration() / 100
  });
}
progressLoop();
document.getElementById("progressBar").addEventListener('click',function(e){
  var x =e.pageX - this.offsetLeft;
  var startpos = document.getElementById('progressBar').position;
  var xconvert = (x-485)/4.55;
  var finalx = (xconvert).toFixed(1);
  document.getElementById('progressBar').value = finalx;
  player.seekTo(Math.round(progress.value*(player.getDuration() / 100)), true);
});

function myfunction1(){
  var dat = JSON.stringify(dict[0]);
  var d = JSON.parse(dat);
document.getElementById("id-0").addEventListener('click',function() {
  document.getElementById("A1").src=d[0].thumbnail;
  document.getElementById("A2").innerHTML= d[0].title;
  document.getElementById("A3").src=d[0].thumbnail;
  document.getElementById("A4").src=d[0].thumbnail;
  document.getElementById("songTitle").innerHTML=d[0].title;
  var id = "https://www.youtube.com/embed/"+d[0].vid_id+"?enablejsapi=1";
  document.getElementById("player2").src = id;
  document.getElementById("row").style.display = "none";
  document.getElementById("play1").src = "/static/img/Pause.png";
  document.getElementById("liked").src = "/static/img/heart1.png";
  i = 1;


});

document.getElementById("id-1").addEventListener('click',function() {
  document.getElementById("A1").src=d[1].thumbnail;
  document.getElementById("A2").innerHTML= d[1].title;
  document.getElementById("A3").src=d[1].thumbnail;
  document.getElementById("A4").src=d[1].thumbnail;
  document.getElementById("songTitle").innerHTML=d[1].title;
  var id = "https://www.youtube.com/embed/"+d[1].vid_id+"?enablejsapi=1";
  document.getElementById("player2").src = id;
  document.getElementById("row").style.display = "none";
  document.getElementById("play1").src = "/static/img/Pause.png";
  document.getElementById("liked").src = "/static/img/heart1.png";
  i = 1;


});

document.getElementById("id-2").addEventListener('click',function() {
  document.getElementById("A1").src=d[2].thumbnail;
  document.getElementById("A2").innerHTML= d[2].title;
  document.getElementById("A3").src=d[2].thumbnail;
  document.getElementById("A4").src=d[2].thumbnail;
  document.getElementById("songTitle").innerHTML=d[2].title;
  var id = "https://www.youtube.com/embed/"+d[2].vid_id+"?enablejsapi=1";
  document.getElementById("player2").src = id;
  document.getElementById("row").style.display = "none";
  document.getElementById("play1").src = "/static/img/Pause.png";
  document.getElementById("liked").src = "/static/img/heart1.png";
  i = 1;


});

document.getElementById("id-3").addEventListener('click',function() {
  document.getElementById("A1").src=d[3].thumbnail;
  document.getElementById("A2").innerHTML= d[3].title;
  document.getElementById("A3").src=d[3].thumbnail;
  document.getElementById("A4").src=d[3].thumbnail;
  document.getElementById("songTitle").innerHTML=d[3].title;
  var id = "https://www.youtube.com/embed/"+d[3].vid_id+"?enablejsapi=1";
  document.getElementById("player2").src = id;
  document.getElementById("row").style.display = "none";
  document.getElementById("play1").src = "/static/img/Pause.png";
  document.getElementById("liked").src = "/static/img/heart1.png";
  i = 1;


});

document.getElementById("id-4").addEventListener('click',function() {
  document.getElementById("A1").src=d[4].thumbnail;
  document.getElementById("A2").innerHTML= d[4].title;
  document.getElementById("A3").src=d[4].thumbnail;
  document.getElementById("A4").src=d[4].thumbnail;
  document.getElementById("songTitle").innerHTML=d[4].title;
  var id = "https://www.youtube.com/embed/"+d[4].vid_id+"?enablejsapi=1";
  document.getElementById("player2").src = id;
  document.getElementById("row").style.display = "none";
  document.getElementById("play1").src = "/static/img/Pause.png";
  document.getElementById("liked").src = "/static/img/heart1.png";
  i = 1;


});

}
$(document).ready(function() {

	$('form').on('submit', function(event) {
		$.ajax({
			data : {
				name : $('#in').val(),
        url: "1",
        title:"1",
			},
			type : 'POST',
			url : '/play',

		})
		.done(function(data) {
      var dat = JSON.stringify(data.data);
      var d = JSON.parse(dat);
      var i = 0;

      if(flag == 0)
      {
      dict.push(d);
      for(i=0;i<5;i++)
      {
        var row = document.getElementById("row");
            var newdiv = document.createElement('div');
            var newdiv1 = document.createElement('div');
            var but =  document.createElement('button');

            var id = "id-"+i;
            but.id=id;
            newdiv.style.padding = "18px";
            newdiv.id="column";
            newdiv1.id="img-text";
            id="iid"+i;

            var newimg = document.createElement('img');
            newimg.src = d[i].thumbnail;
            newimg.id = id;
            newimg.height="200";
            newimg.width="250";

            var x = document.createElement('p');
            var t = document.createTextNode(d[i].title);
            id="fid"+i;
            x.id=id;
            x.appendChild(t);

            but.appendChild(newimg);
            newdiv1.appendChild(but);
            newdiv1.appendChild(x);

            newdiv.appendChild(newdiv1);

            row.appendChild(newdiv);
      }
      flag=1;
    }
    else
    {
      dict[0]=d;
      document.getElementById("row").style.display = "block";
      for(i=0;i<5;i++){
        var id = "iid"+i;
        document.getElementById(id).src = d[i].thumbnail;
        id="fid"+i;
        document.getElementById(id).innerHTML = d[i].title;
      }

    }
      myfunction1();

		});

		event.preventDefault();

	});

});
$(document).ready(function() {

	$('#download').click(function(event) {


		$.ajax({
			data : {
        name:"1",
				url : player.getVideoUrl(),
        title: document.getElementById("songTitle").innerHTML,
			},
			type : 'POST',
			url : '/play',

		})
    .done(function() {
      const a = document.createElement("a");
      a.style.display = "none";
      document.body.appendChild(a);

      a.href="/download";
      a.target="_blank";

      // Trigger the download by simulating click
      a.click();

      // Cleanup
      window.URL.revokeObjectURL(a.href);
      document.body.removeChild(a);


      });
		event.preventDefault();

	});

});



</script>
        </body>


</html>
